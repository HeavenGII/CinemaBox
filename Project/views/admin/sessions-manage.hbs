<div class="page-container main-wrapper">
    <h1>üóìÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∞–Ω—Å–∞–º–∏</h1>

    {{#if error}}
        <div class="alert alert-error">{{error}}</div>
    {{/if}}
    {{#if success}}
        <div class="alert alert-success">{{success}}</div>
    {{/if}}

    <section class="admin-form-block">
        <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ–∞–Ω—Å</h2>
        <form action="/admin/sessions" method="POST" class="form-container">

            <div class="form-group">
                <label for="movieId">–§–∏–ª—å–º:</label>
                <select id="movieId" name="movieId" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º --</option>
                    {{#each movies}}
                        <option value="{{movieid}}"
                                {{#ifeq movieid ../formData.movieId}}selected{{/ifeq}}
                        >
                            {{title}} ({{price}} ‚ÇΩ)
                        </option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label for="hallId">–ó–∞–ª:</label>
                <select id="hallId" name="hallId" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª --</option>
                    {{#each halls}}
                        <option value="{{hallid}}"
                                {{#ifeq hallid ../formData.hallId}}selected{{/ifeq}}
                        >
                            {{name}} ({{rowscount}} —Ä—è–¥–æ–≤, {{seatsperrow}} –º–µ—Å—Ç)
                        </option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label for="startTime">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                <input type="datetime-local"
                       id="startTime"
                       name="startTime"
                       value="{{formData.startTime}}"
                       min="{{formatDate (now) 'YYYY-MM-DDTHH:MM'}}"
                       required>
                <small class="form-text-muted">–í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DDTHH:MM</small>
            </div>

            <button type="submit" class="btn btn-primary btn-lg">–°–æ–∑–¥–∞—Ç—å —Å–µ–∞–Ω—Å</button>
        </form>
    </section>

    <hr class="divider">

    <section class="screenings-list-block">
        <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ–∞–Ω—Å–æ–≤</h2>

        {{#if upcomingScreenings.length}}
            <table class="admin-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>–§–∏–ª—å–º</th>
                    <th>–ó–∞–ª</th>
                    <th>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody>
                {{#each upcomingScreenings}}
                    <tr class="{{#if iscancelled}}cancelled-row{{/if}}">
                        <td>{{screeningid}}</td>
                        <td>{{movietitle}}</td>
                        <td>{{hallname}}</td>
                        <td>{{formatDate starttime 'D MMM YYYY –≤ HH:mm'}}</td>
                        <td>
                            {{#if iscancelled}}
                                <span class="status-cancelled">–û—Ç–º–µ–Ω–µ–Ω</span>
                            {{else}}
                                <span class="status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            {{/if}}
                        </td>
                        <td>
                            {{#unless iscancelled}}
                                <form action="/admin/sessions/{{screeningid}}/cancel" method="POST" style="display:inline;" onsubmit="return confirm('–û—Ç–º–µ–Ω–∏—Ç—å —Å–µ–∞–Ω—Å {{movieTitle}} –≤ {{hallName}}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–∏—Ç –≤—Å–µ –±—Ä–æ–Ω–∏.');">
                                    <button type="submit" class="btn-text-link btn-danger-link">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                                </form>
                            {{/unless}}
                        </td>
                    </tr>
                {{/each}}
                </tbody>
            </table>
        {{else}}
            <p>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ–∞–Ω—Å–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        {{/if}}
    </section>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const startTimeInput = document.getElementById('startTime');

        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ (—Ç.–µ. –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ formData)
        if (!startTimeInput.value) {
            const now = new Date();
            // –°–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 15 –º–∏–Ω—É—Ç
            now.setMinutes(now.getMinutes() - (now.getMinutes() % 15) + 15);

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
            startTimeInput.value = formattedDateTime;
        }
    });
</script>