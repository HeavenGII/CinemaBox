<div class="movie-details-container">
    <div class="movie-header">
        <div class="movie-poster">
            <img src="{{movie.posterurl}}" alt="–ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞ {{movie.title}}">
            <span class="rating-badge-lg">{{movie.ratingavg}} ‚≠ê</span>
            {{#if movie.agerestriction}}
                <div class="age-restriction-badge age-{{movie.agerestriction}}">
                    {{movie.agerestriction}}+
                </div>
            {{/if}}
        </div>

        <div class="movie-info">
            <div class="movie-title-group">
                <h1>{{movie.title}} ({{movie.releaseyear}})</h1>
                {{#if isAdmin}}
                    <a href="/admin/movies/{{movie.movieid}}/edit" class="btn btn-admin-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å–º">
                        <i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                    </a>
                {{/if}}
            </div>

            <div class="meta-data">
                <p><strong>–ñ–∞–Ω—Ä:</strong> {{movie.genre}}</p>
                <p><strong>–†–µ–∂–∏—Å—Å–µ—Ä:</strong> <a href="/director/{{movie.directorid}}" class="director-link">{{movie.directorname}}</a></p>
                <p><strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{formatDuration movie.durationmin}}</p>

                <!-- –ü–ï–†–ï–ú–ï–©–ê–ï–ú –¶–ï–ù–£ –°–Æ–î–ê -->
                {{#if movie.price}}
                    <p><strong>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞:</strong> <span class="price-text">{{movie.price}} BYN</span></p>
                {{/if}}
            </div>


            <!-- –ù–û–í–´–ô –ë–õ–û–ö –î–õ–Ø –°–¢–û–†–û–ù–ù–ò–• –†–ï–ô–¢–ò–ù–ì–û–í -->
            <div class="external-ratings-block" data-movie-title="{{movie.title}}" data-movie-year="{{movie.releaseyear}}">
                <p><strong>–°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏:</strong></p>
                <div id="external-ratings-results">
                    <p class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤...</p>
                </div>
            </div>
            <!-- –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –†–ï–ô–¢–ò–ù–ì–û–í -->

            {{#if firstUpcomingScreening}}
                <div class="screening-info-block">
                    <p>
                        <strong>–ë–ª–∏–∂–∞–π—à–∏–π —Å–µ–∞–Ω—Å:</strong>
                        {{formatDate firstUpcomingScreening.starttime}} (–ó–∞–ª: {{firstUpcomingScreening.hallname}})
                    </p>
                </div>
                <div class="movie-actions">
                    <a href="/movies/{{movie.movieid}}/select-time" class="btn btn-primary btn-lg">
                        –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</a>
                </div>
            {{else}}
                <div class="alert alert-info movie-actions-placeholder">
                    –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ–∞–Ω—Å–æ–≤ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤.
                </div>
            {{/if}}
        </div>
    </div>

    <div class="movie-description-block">
        <h2>–û —Ñ–∏–ª—å–º–µ</h2>
        <p>{{movie.description}}</p>
    </div>

    {{#if movie.trailerId}}
        <div class="movie-video-block">
            <div class="video-switch-tabs">
                {{#if movie.onlineenabled}}
                    <button class="video-tab-btn {{#unless watchOnline}}active{{/unless}}" data-type="trailer">
                        <i class="fas fa-play-circle"></i>
                        <span>–¢—Ä–µ–π–ª–µ—Ä</span>
                    </button>
                    <button class="video-tab-btn {{#if watchOnline}}active{{/if}}" data-type="movie">
                        <i class="fas fa-film"></i>
                        <span>–í–µ—Å—å —Ñ–∏–ª—å–º</span>
                    </button>
                {{else}}
                    <div class="video-tab-btn active" style="cursor: default;">
                        <i class="fas fa-play-circle"></i>
                        <span>–¢—Ä–µ–π–ª–µ—Ä</span>
                    </div>
                {{/if}}
            </div>

            <div class="video-container">
                <div id="trailerVideo" class="video-content {{#unless watchOnline}}active{{/unless}}">
                    <div class="video-wrapper">
                        <div class="trailer-iframe-container">
                            <iframe
                                    width="100%"
                                    height="100%"
                                    src="https://www.youtube.com/embed/{{movie.trailerId}}"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                </div>

                <!-- –§–∏–ª—å–º –æ–Ω–ª–∞–π–Ω (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) -->
                {{#if movie.onlineenabled}}
                    <div id="movieVideo" class="video-content {{#if watchOnline}}active{{/if}}">
                        <div class="video-wrapper">
                            <video
                                    id="onlineMoviePlayer"
                                    controlsList="nodownload"
                                    poster="{{movie.posterurl}}"
                                    class="movie-video-player"
                                    preload="metadata"
                                    data-movie-id="{{movie.movieid}}"
                                    data-base-url="{{movie.onlineurl}}"
                            >
                                <source src="{{movie.onlineurl}}/master.m3u8" type="application/x-mpegURL">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Ç–µ–≥.
                            </video>

                            <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ -->
                            <div class="custom-video-controls">
                                <button class="control-btn play-pause-btn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">
                                    <i class="fas fa-play"></i>
                                </button>

                                <input type="range" class="progress-bar" min="0" max="100" value="0" step="0.1">

                                <div class="time-display">
                                    <span class="current-time">0:00</span> /
                                    <span class="total-time">0:00</span>
                                </div>

                                <div class="volume-container">
                                    <button class="control-btn volume-btn" title="–ó–≤—É–∫">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                    <input type="range" class="volume-slider" min="0" max="1" step="0.1" value="1">
                                </div>

                                <div class="quality-selector">
                                    <button class="control-btn quality-btn" title="–ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ">
                                        <i class="fas fa-hd"></i>
                                        <span class="current-quality">Auto</span>
                                    </button>
                                    <div class="quality-menu">
                                        <div class="quality-option" data-quality="auto">–ê–≤—Ç–æ</div>
                                        <div class="quality-option" data-quality="1080p">1080p</div>
                                        <div class="quality-option" data-quality="720p">720p</div>
                                        <div class="quality-option" data-quality="480p">480p</div>
                                        <div class="quality-option" data-quality="360p">360p</div>
                                    </div>
                                </div>

                                <button class="control-btn fullscreen-btn" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>

                        <div class="video-info">
                            <div class="info-badge">
                                <i class="fas fa-clock"></i>
                                <span>{{formatDuration movie.durationmin}}</span>
                            </div>
                            <div class="info-badge quality-info">
                                <i class="fas fa-hd"></i>
                                <span class="current-quality-info">–ê–≤—Ç–æ</span>
                            </div>
                            {{#if movie.agerestriction}}
                                <div class="info-badge age-badge age-{{movie.agerestriction}}">
                                    <span>{{movie.agerestriction}}+</span>
                                </div>
                            {{/if}}
                        </div>
                    </div>
                {{/if}}
            </div>
        </div>
    {{/if}}

    {{#if movieShorts.length}}
        <div class="movie-shorts-block">
            <h2>üé¨ –®–æ—Ä—Ç—Å—ã –∫ —Ñ–∏–ª—å–º—É ({{movieShorts.length}})</h2>
            <div class="slider-container shorts-slider-container">
                <button class="slider-arrow slider-prev" data-target="shorts-slider">
                    &#10094;
                </button>

                <div class="shorts-grid slider-wrapper" id="shorts-slider">
                    {{#each movieShorts}}
                        <div class="short-card">
                            <a href="/shorts?movieid={{../movie.movieid}}#{{this.shortid}}" title="{{this.title}}">
                            <div class="short-placeholder-video">
                                <i class="material-icons">play_circle_filled</i>
                            </div>
                            <span class="short-duration">{{this.durationsec}} —Å–µ–∫—É–Ω–¥</span>
                            </a>
                            <div class="card-info">
                                <h3>{{this.title}}</h3>
                            </div>
                        </div>
                    {{/each}}
                </div>

                <button class="slider-arrow slider-next" data-target="shorts-slider">
                    &#10095;
                </button>
            </div>
        </div>
    {{/if}}

    <!-- –ù–û–í–´–ô –ë–õ–û–ö –û–¢–ó–´–í–û–í -->
    <div class="reviews-section" id="reviews-section">
        <h2>–û—Ç–∑—ã–≤—ã –∑—Ä–∏—Ç–µ–ª–µ–π</h2>
        {{#if movie.isactive}}
            {{#if error}}
                <div class="alert alert-error">{{error}}</div>
            {{/if}}
            {{#if success}}
                <div class="alert alert-success">{{success}}</div>
            {{/if}}

            {{#if isAuthenticated}}
                <div class="review-form-container">
                    {{#if currentUserReview}}
                        <h3>–í–∞—à –æ—Ç–∑—ã–≤ (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)</h3>
                        <form action="/movies/{{movie.movieid}}/review" method="POST" id="edit-review-form">
                            <div class="form-group rating-group">
                                <label>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</label>
                                <div class="star-rating-area">
                                    <input type="radio" id="star5-edit" name="rating" value="5" {{#ifeq currentUserReview.rating 5}}checked{{/ifeq}} required>
                                    <label for="star5-edit" title="5 –ó–≤–µ–∑–¥"></label>
                                    <input type="radio" id="star4-edit" name="rating" value="4" {{#ifeq currentUserReview.rating 4}}checked{{/ifeq}}>
                                    <label for="star4-edit" title="4 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star3-edit" name="rating" value="3" {{#ifeq currentUserReview.rating 3}}checked{{/ifeq}}>
                                    <label for="star3-edit" title="3 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star2-edit" name="rating" value="2" {{#ifeq currentUserReview.rating 2}}checked{{/ifeq}}>
                                    <label for="star2-edit" title="2 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star1-edit" name="rating" value="1" {{#ifeq currentUserReview.rating 1}}checked{{/ifeq}}>
                                    <label for="star1-edit" title="1 –ó–≤–µ–∑–¥–∞"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="reviewText-edit">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤):</label>
                                <textarea name="reviewText" id="reviewText-edit" rows="6" maxlength="500">{{currentUserReview.reviewtext}}</textarea>
                            </div>

                            <h3>–í–∞—à –æ—Ç–∑—ã–≤ (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)</h3>
                            <div class="review-edit-actions">
                                <form action="/movies/{{movie.movieid}}/review" method="POST" id="edit-review-form">

                                    <button type="submit" class="btn btn-primary btn-sm">–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                                </form>

                                <form action="/movies/{{movie.movieid}}/review/delete" method="POST"
                                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤ –∏ –æ—Ü–µ–Ω–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');"
                                      class="delete-user-review-form">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <i class="fas fa-trash-alt"></i> –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤
                                    </button>
                                </form>
                            </div>
                        </form>

                    {{else}}
                        <h3>–û—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤</h3>
                        <form action="/movies/{{movie.movieid}}/review" method="POST">
                            <div class="form-group rating-group">
                                <label>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</label>
                                <div class="star-rating-area">
                                    <input type="radio" id="star5-new" name="rating" value="5" required>
                                    <label for="star5-new" title="5 –ó–≤–µ–∑–¥"></label>
                                    <input type="radio" id="star4-new" name="rating" value="4">
                                    <label for="star4-new" title="4 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star3-new" name="rating" value="3">
                                    <label for="star3-new" title="3 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star2-new" name="rating" value="2">
                                    <label for="star2-new" title="2 –ó–≤–µ–∑–¥—ã"></label>
                                    <input type="radio" id="star1-new" name="rating" value="1">
                                    <label for="star1-new" title="1 –ó–≤–µ–∑–¥–∞"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="reviewText-new">–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤):</label>
                                <textarea name="reviewText" id="reviewText-new" rows="6" maxlength="500"></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</button>
                        </form>
                    {{/if}}
                </div>

            {{else}}
                <div class="alert alert-info review-login-message">
                    <a href="/auth/login">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤ –∏ –æ—Ü–µ–Ω–∫—É.
                </div>
            {{/if}}

        {{else}}
            <div class="alert alert-info review-login-message">
                –û—Ç–∑—ã–≤—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–∏–ª—å–º—ã, –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –ø—Ä–æ–∫–∞—Ç–µ.
            </div>
        {{/if}}

        <div class="reviews-list">
            <!-- 1. –û–¢–ó–´–í –¢–ï–ö–£–©–ï–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–µ—Å–ª–∏ –µ—Å—Ç—å) - –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–µ—Ä–≤—ã–º -->
            {{#if currentUserReview}}
                <div class="review-item user-review-highlight">
                    <div class="review-header">
                        <span class="review-author">–í—ã</span>
                        <span class="review-rating">{{currentUserReview.rating}} ‚≠ê</span>
                        <span class="review-date">{{formatDate currentUserReview.createdat}}</span>
                    </div>
                    <p class="review-text">{{currentUserReview.reviewtext}}</p>
                </div>
            {{/if}}

            <!-- 2. –û–°–¢–ê–õ–¨–ù–´–ï –û–¢–ó–´–í–´ -->
            {{#each reviews}}
                <div class="review-item">
                    <div class="review-header">
                        <span class="review-author">{{this.nickname}}</span>
                        <span class="review-rating">{{this.rating}} ‚≠ê</span>
                        <span class="review-date">{{formatDate this.createdat}}</span>

                        <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–ù–û–ü–ö–ò –£–î–ê–õ–ï–ù–ò–Ø –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê -->
                        {{#if ../isAdmin}}
                            <!-- –ò–°–ü–û–õ–¨–ó–£–ï–ú –ö–õ–ê–°–° .btn-text-link –í–ú–ï–°–¢–û –ö–õ–ê–°–°–ê –ö–ù–û–ü–ö–ò –° –ò–ö–û–ù–ö–û–ô -->
                            <div class="admin-review-actions">
                                <form action="/admin/reviews/{{this.reviewid}}/delete" method="POST" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ?');">
                                    <button type="submit" class="btn-text-link" title="–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤">
                                        –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </form>
                            </div>
                        {{/if}}
                        <!-- –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ö–ù–û–ü–ö–ò -->

                    </div>
                    <p class="review-text">{{this.reviewtext}}</p>
                </div>
            {{else}}
                {{#unless currentUserReview}}
                    {{#if movie.isactive}}
                        <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –æ—Ç–∑—ã–≤ –Ω–∞ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º!</p>
                    {{/if}}
                {{/unless}}
            {{/each}}
        </div>
    </div>
</div>

<style>
    :root {
        /* ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ... */
        --progress: 0%;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .movie-details-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
        color: var(--text-primary);
        transition: color 0.3s ease;
    }

    /* –®–∞–ø–∫–∞ —Ñ–∏–ª—å–º–∞ */
    .movie-header {
        display: flex;
        gap: 50px;
        margin-bottom: 50px;
        flex-wrap: wrap;
    }

    .movie-poster {
        flex-shrink: 0;
        position: relative;
        width: 300px;
        height: 450px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 8px 30px var(--shadow-color);
        background-color: var(--bg-card);
        transition: all 0.3s ease;
    }

    .movie-poster img {
        width: 100%;
        height: auto;
        display: block;
        transition: transform 0.3s ease;
    }

    .movie-poster:hover img {
        transform: scale(1.03);
    }

    .rating-badge-lg {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 1.2rem;
        font-weight: bold;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 10;
    }

    /* –í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ */
    .age-restriction-badge {
        position: absolute;
        bottom: 15px;
        left: 15px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.5rem;
        color: white;
        z-index: 10;
        box-shadow: 0 3px 10px var(--shadow-color);
        border: 3px solid white;
    }

    .age-0 { background-color: #4CAF50; }
    .age-6 { background-color: #2196F3; }
    .age-12 { background-color: #FF9800; }
    .age-16 { background-color: #F44336; }
    .age-18 { background-color: #000000; }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å–º–µ */
    .movie-info {
        flex-grow: 1;
        min-width: 300px;
    }

    .movie-title-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .movie-title-group h1 {
        font-size: 2.8rem;
        color: var(--text-primary);
        margin: 0;
        font-weight: bold;
        line-height: 1.2;
        flex-grow: 1;
    }

    .btn-admin-edit {
        display: inline-flex;
        align-items: center;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: bold;
        text-transform: uppercase;
        background-color: var(--success-color);
        color: white;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        gap: 8px;
        white-space: nowrap;
    }

    .btn-admin-edit:hover {
        background-color: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    .btn-admin-edit:active {
        transform: translateY(0);
    }

    /* –ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ */
    .meta-data {
        margin-bottom: 30px;
    }

    .meta-data p {
        font-size: 1.1rem;
        margin: 12px 0;
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .meta-data strong {
        color: var(--text-primary);
        font-weight: 600;
    }

    .director-link {
        color: inherit;
        text-decoration: none;
        border-bottom: 1px solid var(--border-color);
        transition: color 0.2s, border-bottom-color 0.2s;
        font-weight: 500;
        padding-bottom: 2px;
    }

    .director-link:hover {
        color: var(--accent-primary);
        border-bottom-color: var(--accent-primary);
    }

    .price-text {
        color: var(--accent-primary);
        font-weight: bold;
        font-size: 1.3rem;
        margin-left: 5px;
    }

    /* –í–Ω–µ—à–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ */
    .external-ratings-block {
        margin: 25px 0;
        padding: 20px;
        border: 2px dashed var(--border-color);
        border-radius: 10px;
        max-width: 500px;
        background-color: var(--bg-card);
    }

    #external-ratings-results {
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .external-rating-item {
        font-size: 1rem;
        color: var(--text-secondary);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background-color: var(--bg-primary);
        border-radius: 6px;
        border-left: 4px solid var(--accent-primary);
    }

    .external-rating-item strong {
        color: var(--text-primary);
        font-size: 1.1rem;
    }

    .loading-text {
        color: var(--text-muted);
        font-style: italic;
        text-align: center;
        padding: 10px;
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–∞–Ω—Å–µ */
    .screening-info-block {
        margin: 25px 0;
        padding: 15px 20px;
        background-color: var(--bg-card);
        border-radius: 8px;
        border-left: 4px solid var(--accent-primary);
    }

    .screening-info-block p {
        margin: 0;
        color: var(--text-primary);
        font-size: 1.1rem;
    }

    .screening-info-block strong {
        color: var(--accent-primary);
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .movie-actions {
        margin-top: 25px;
    }

    .btn-primary {
        display: inline-flex;
        align-items: center;
        padding: 14px 30px;
        background-color: var(--accent-primary);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        gap: 10px;
    }

    .btn-primary:hover {
        background-color: var(--accent-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(229, 9, 20, 0.3);
    }

    .btn-primary:active {
        transform: translateY(0);
    }

    .btn-danger {
        background-color: var(--error-color);
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-danger:hover {
        background-color: #c82333;
        transform: translateY(-2px);
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .alert {
        padding: 15px 20px;
        margin: 20px 0;
        border-radius: 8px;
        font-weight: bold;
        border: 1px solid transparent;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .alert-info {
        background-color: rgba(23, 162, 184, 0.1);
        color: var(--info-color);
        border-color: rgba(23, 162, 184, 0.3);
    }

    .alert-error {
        background-color: rgba(229, 9, 20, 0.1);
        color: var(--error-color);
        border-color: rgba(229, 9, 20, 0.3);
    }

    .alert-success {
        background-color: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
        border-color: rgba(40, 167, 69, 0.3);
    }

    .alert a {
        color: inherit;
        text-decoration: underline;
        font-weight: bold;
    }

    /* –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ */
    .movie-description-block {
        margin: 50px 0;
    }

    .movie-description-block h2 {
        font-size: 28px;
        color: var(--text-primary);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
        font-weight: bold;
    }

    .description-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--text-secondary);
        text-align: justify;
    }

    /* –¢—Ä–µ–π–ª–µ—Ä */
    .movie-trailer-block {
        margin: 50px 0;
    }

    .movie-trailer-block h2 {
        font-size: 28px;
        color: var(--text-primary);
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
        font-weight: bold;
    }

    .trailer-iframe-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 25px var(--shadow-color);
    }

    .trailer-iframe-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    /* –®–æ—Ä—Ç—Å—ã */
    .movie-shorts-block {
        margin: 50px 0;
    }

    .movie-shorts-block h2 {
        font-size: 28px;
        color: var(--text-primary);
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .shorts-slider-container {
        position: relative;
        padding: 0 50px;
    }

    .shorts-grid {
        display: flex;
        overflow-x: auto;
        padding: 20px 0;
        gap: 20px;
        scroll-behavior: smooth;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .shorts-grid::-webkit-scrollbar {
        display: none;
    }

    .short-card {
        flex: 0 0 160px;
        height: 280px;
        background-color: var(--bg-card);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px var(--shadow-color);
        transition: transform 0.3s ease;
    }

    .short-card:hover {
        transform: translateY(-8px) scale(1.03);
        box-shadow: 0 12px 30px var(--shadow-color);
    }

    .short-card-link {
        display: block;
        height: 75%;
        position: relative;
        text-decoration: none;
        overflow: hidden;
    }

    .short-placeholder-video {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--accent-primary), #333);
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
    }

    .short-card:hover .short-placeholder-video {
        background: linear-gradient(135deg, var(--accent-hover), #444);
    }

    .short-placeholder-video i {
        font-size: 60px;
        color: white;
        opacity: 0.9;
        transition: transform 0.3s ease;
    }

    .short-card:hover .short-placeholder-video i {
        transform: scale(1.1);
    }

    .short-duration {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }

    .short-card-info {
        height: 25%;
        padding: 12px;
        display: flex;
        align-items: center;
        background-color: var(--bg-primary);
    }

    .short-card-info h3 {
        font-size: 14px;
        margin: 0;
        color: var(--text-primary);
        font-weight: 600;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .slider-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: var(--bg-card);
        color: var(--text-primary);
        border: none;
        cursor: pointer;
        z-index: 10;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px var(--shadow-color);
    }

    .slider-arrow:hover {
        background: var(--accent-primary);
        color: white;
        transform: translateY(-50%) scale(1.1);
    }

    .slider-prev {
        left: 0;
    }

    .slider-next {
        right: 0;
    }

    /* –û—Ç–∑—ã–≤—ã */
    .reviews-section {
        margin: 60px 0 30px 0;
        padding-top: 30px;
        border-top: 2px solid var(--border-color);
    }

    .reviews-section h2 {
        font-size: 28px;
        color: var(--text-primary);
        margin-bottom: 30px;
        font-weight: bold;
    }

    /* –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ */
    .review-form-container {
        padding: 25px;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 40px;
        background-color: var(--bg-card);
        box-shadow: 0 4px 20px var(--shadow-color);
    }

    .review-form-container h3 {
        margin-top: 0;
        margin-bottom: 25px;
        color: var(--text-primary);
        font-size: 22px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        color: var(--text-primary);
        font-size: 16px;
    }

    .rating-group {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    /* –ó–≤–µ–∑–¥–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ */
    .star-rating-area {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
    }

    .star-rating-area input[type="radio"] {
        display: none;
    }

    .star-rating-area label {
        font-size: 0;
        color: var(--border-color);
        cursor: pointer;
        transition: color 0.2s;
        line-height: 1;
        padding: 0 5px;
        margin: 0;
    }

    .star-rating-area label::before {
        content: '‚òÖ';
        font-size: 2.5rem;
        color: inherit;
    }

    .star-rating-area label:hover,
    .star-rating-area label:hover ~ label,
    .star-rating-area input[type="radio"]:checked ~ label {
        color: #ffc107;
    }

    /* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ */
    textarea {
        width: 100%;
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background-color: var(--bg-input);
        color: var(--text-primary);
        font-size: 16px;
        resize: vertical;
        transition: border-color 0.3s;
        font-family: inherit;
    }

    textarea:focus {
        border-color: var(--accent-primary);
        outline: none;
        box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.1);
        background-color: var(--bg-input-focus);
    }

    textarea::placeholder {
        color: var(--text-muted);
    }

    .char-counter {
        text-align: right;
        font-size: 14px;
        color: var(--text-muted);
        margin-top: 5px;
    }

    /* –î–µ–π—Å—Ç–≤–∏—è —Å –æ—Ç–∑—ã–≤–æ–º */
    .review-edit-actions {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    /* –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ */
    .reviews-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .no-reviews-message {
        text-align: center;
        padding: 50px 20px;
        color: var(--text-muted);
        background-color: var(--bg-card);
        border-radius: 10px;
        border: 2px dashed var(--border-color);
    }

    .no-reviews-message p {
        font-size: 18px;
        margin: 0;
    }

    .review-item {
        padding: 25px;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        background-color: var(--bg-card);
        transition: transform 0.3s ease;
    }

    .review-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px var(--shadow-color);
    }

    .user-review-highlight {
        border-color: var(--accent-primary);
        background-color: rgba(229, 9, 20, 0.05);
        order: -1;
    }

    .review-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-color);
        flex-wrap: wrap;
        gap: 15px;
    }

    .review-author {
        font-weight: bold;
        color: var(--accent-primary);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .review-rating {
        font-weight: bold;
        color: #ffc107;
        font-size: 1.1rem;
        background-color: rgba(255, 193, 7, 0.1);
        padding: 4px 10px;
        border-radius: 20px;
    }

    .review-date {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-left: auto;
    }

    .review-text {
        margin-top: 15px;
        line-height: 1.7;
        color: var(--text-secondary);
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    .admin-review-actions {
        margin-left: auto;
    }

    .btn-text-link {
        background: none;
        border: none;
        padding: 5px 10px;
        color: var(--error-color);
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        border-radius: 4px;
    }

    .btn-text-link:hover {
        background-color: rgba(220, 53, 69, 0.1);
        text-decoration: underline;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 1024px) {
        .movie-header {
            gap: 40px;
        }

        .movie-poster {
            width: 280px;
        }

        .movie-title-group h1 {
            font-size: 2.4rem;
        }
    }

    @media (max-width: 768px) {
        .movie-details-container {
            padding: 0 15px;
            margin: 30px auto;
        }

        .movie-header {
            flex-direction: column;
            gap: 30px;
        }

        .movie-poster {
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
        }

        .movie-title-group {
            flex-direction: column;
            align-items: flex-start;
        }

        .movie-title-group h1 {
            font-size: 2rem;
            text-align: center;
            width: 100%;
        }

        .btn-admin-edit {
            align-self: stretch;
            text-align: center;
            justify-content: center;
        }

        .shorts-slider-container {
            padding: 0 40px;
        }

        .short-card {
            flex: 0 0 140px;
            height: 250px;
        }

        .slider-arrow {
            width: 40px;
            height: 40px;
            font-size: 20px;
        }

        .review-edit-actions {
            flex-direction: column;
        }

        .btn-primary, .btn-danger {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .movie-title-group h1 {
            font-size: 1.8rem;
        }

        .movie-poster {
            max-width: 300px;
        }

        .rating-badge-lg {
            font-size: 1rem;
            padding: 8px 12px;
        }

        .age-restriction-badge {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }

        .shorts-slider-container {
            padding: 0 35px;
        }

        .short-card {
            flex: 0 0 130px;
            height: 230px;
        }

        .short-placeholder-video i {
            font-size: 50px;
        }

        .review-form-container {
            padding: 20px;
        }

        .star-rating-area label::before {
            font-size: 2rem;
        }

        .review-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }

        .review-date {
            margin-left: 0;
        }

        .admin-review-actions {
            margin-left: 0;
            margin-top: 10px;
        }
    }
    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ –Ω–∞–¥ –≤–∏–¥–µ–æ */
    .video-switch-tabs {
        display: flex;
        background: var(--bg-card);
        border-radius: 12px 12px 0 0;
        overflow: hidden;
        border-bottom: 2px solid var(--border-color);
        justify-content: flex-start; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
        padding: 0 20px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã –ø–æ –±–æ–∫–∞–º */
    }

    .video-tab-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
        white-space: nowrap; /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª—Å—è */
        min-width: 120px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–æ–∫ */
    }

    .video-tab-btn:hover {
        background: rgba(229, 9, 20, 0.05);
        color: var(--text-primary);
    }

    .video-tab-btn.active {
        color: var(--accent-primary);
        border-bottom-color: var(--accent-primary);
        background: rgba(229, 9, 20, 0.1);
    }

    .video-tab-btn i {
        font-size: 16px; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∏–ª–∏ –∏–∫–æ–Ω–∫–∏ */
    }

    .video-container {
        position: relative;
        background: var(--bg-card);
        border-radius: 0 0 12px 12px;
        overflow: hidden;
    }

    .video-content {
        display: none;
        width: 100%;
    }

    .video-content.active {
        display: block;
    }

    /* –ü–ª–µ–µ—Ä –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ñ–∏–ª—å–º–∞ */
    .video-wrapper {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 16:9 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        background: #000;
    }

    /* –ü–ª–µ–µ—Ä –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ñ–∏–ª—å–º–∞ */
    .movie-video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* –ö–ª—é—á–µ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ - –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        display: block;
    }

    /* –î–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
    .video-wrapper:fullscreen .movie-video-player {
        object-fit: contain; /* –í –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é */
    }

    #trailerVideo .video-wrapper {
        padding-top: 0;
    }

    #trailerVideo .trailer-iframe-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%;
        background: var(--bg-primary);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 25px var(--shadow-color);
    }

    #trailerVideo .trailer-iframe-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    #movieVideo .video-wrapper {
        position: relative;
        padding-top: 56.25%;
        background: #000;
    }

    #movieVideo .movie-video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ñ–∏–ª—å–º–∞ */
    #movieVideo .video-wrapper:fullscreen {
        padding-top: 0;
    }

    #movieVideo .video-wrapper:fullscreen .movie-video-player {
        width: 100vw;
        height: 100vh;
        object-fit: contain;
    }

    /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ç—Ä–µ–π–ª–µ—Ä–∞ */
    #trailerVideo .video-wrapper:fullscreen {
        padding-top: 0;
    }

    #trailerVideo .video-wrapper:fullscreen .trailer-iframe-container {
        width: 100vw;
        height: 100vh;
        border-radius: 0;
    }

    #trailerVideo .video-wrapper:fullscreen .trailer-iframe-container iframe {
        width: 100vw;
        height: 100vh;
    }


    /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è –≤–∏–¥–µ–æ */
    .custom-video-controls {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.7), transparent);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        z-index: 100;
    }
    .video-wrapper.video-paused .custom-video-controls {
        opacity: 1;
        visibility: visible;
    }
    :fullscreen .custom-video-controls,
    :-webkit-full-screen .custom-video-controls,
    :-moz-full-screen .custom-video-controls {
        background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.8));
        padding-bottom: 30px;
    }

    .movie-video-player:hover + .custom-video-controls,
    .custom-video-controls:hover {
        opacity: 1;
    }

    .control-btn {
        background: rgba(255, 255, 255, 0.9);
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
        font-size: 14px;
        transition: all 0.2s ease;
    }

    .control-btn:hover {
        background: white;
        transform: scale(1.1);
    }

    .progress-bar {
        flex: 1;
        height: 4px;
        -webkit-appearance: none;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        outline: none;
        cursor: pointer;
    }

    .progress-bar::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
    }

    .progress-bar::-moz-range-thumb {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
        border: none;
    }

    .time-display {
        color: white;
        font-family: monospace;
        font-size: 13px;
        min-width: 90px;
    }

    .volume-container {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .volume-slider {
        width: 60px;
        height: 4px;
        -webkit-appearance: none;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        outline: none;
        opacity: 0;
        transition: opacity 0.3s ease, width 0.3s ease;
    }

    .volume-container:hover .volume-slider {
        opacity: 1;
        width: 80px;
    }

    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
    }

    .volume-slider::-moz-range-thumb {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        border: none;
    }

    .video-info {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: var(--bg-card);
        border-top: 1px solid var(--border-color);
    }

    .info-badge {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        background: var(--bg-primary);
        border-radius: 6px;
        font-size: 13px;
        color: var(--text-secondary);
    }

    .info-badge i {
        color: var(--accent-primary);
    }

    .age-badge {
        color: white !important;
        font-weight: bold;
    }

    .age-0 { background: #4CAF50; }
    .age-6 { background: #2196F3; }
    .age-12 { background: #FF9800; }
    .age-16 { background: #F44336; }
    .age-18 { background: #000; }

    /* –¢—Ä–µ–π–ª–µ—Ä */
    .trailer-iframe-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* 16:9 */
        background: var(--bg-primary);
    }

    .trailer-iframe-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Ñ–∏–ª—å–º–∞ - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ */
    .movie-actions {
        display: flex;
        gap: 20px;
        margin-top: 30px;
        flex-wrap: wrap;
    }

    .btn-primary, .btn-success {
        flex: 1;
        min-width: 200px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 16px 30px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--accent-primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--accent-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(229, 9, 20, 0.3);
    }

    .btn-success {
        background: var(--success-color);
        color: white;
    }

    .btn-success:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .video-switch-tabs {
            flex-direction: column;
        }

        .video-tab-btn {
            padding: 15px;
            justify-content: flex-start;
            padding-left: 25px;
            border-bottom: 1px solid var(--border-color);
            border-right: none;
        }

        .video-tab-btn.active {
            border-bottom: 3px solid var(--accent-primary);
            border-right: none;
        }

        .custom-video-controls {
            flex-wrap: wrap;
            padding: 10px;
            gap: 10px;
        }

        .progress-bar {
            order: 1;
            width: 100%;
            margin-bottom: 5px;
        }

        .time-display {
            order: 2;
            text-align: center;
            min-width: auto;
            flex: 1;
        }

        .btn-primary, .btn-success {
            min-width: 100%;
        }

        .movie-actions {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .video-tab-btn {
            font-size: 14px;
            padding: 12px 20px;
        }

        .video-tab-btn i {
            font-size: 16px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }

        .volume-slider {
            width: 40px;
        }

        .volume-container:hover .volume-slider {
            width: 50px;
        }
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –≤–∏–¥–µ–æ */
    .progress-bar {
        flex: 1;
        height: 6px;
        -webkit-appearance: none;
        appearance: none;
        background: linear-gradient(to right,
        var(--accent-primary) 0%,
        var(--accent-primary) var(--progress, 0%),
        rgba(255, 255, 255, 0.2) var(--progress, 0%),
        rgba(255, 255, 255, 0.2) 100%
        );
        border-radius: 3px;
        outline: none;
        cursor: pointer;
        position: relative;
    }

    /* –ü–æ–ª–∑—É–Ω–æ–∫ */
    .progress-bar::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    .progress-bar::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    .quality-selector {
        position: relative;
        margin-left: 8px;
    }

    .quality-btn {
        background: transparent !important; /* –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
        border: none;
        color: white;
        font-size: 15px;
        font-weight: 500;
        padding: 4px 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
        min-width: auto;
        height: 32px;
        letter-spacing: 0.3px;
        box-shadow: none !important;
    }

    .quality-btn:hover {
        transform: scale(1.05);
    }

    .quality-btn i {
        font-size: 16px;
        color: var(--accent-primary);
        margin-right: 2px;
    }

    .quality-btn .current-quality {
        font-weight: 600;
        background: transparent !important;
        padding: 2px 4px;
        border-radius: 3px;
        color: white;
        transition: all 0.2s ease;
        font-size: 15px;
    }

    .quality-btn:hover .current-quality {
        transform: scale(1.1);
        color: var(--accent-primary);
    }

    .quality-menu {
        position: absolute;
        bottom: 40px;
        right: 0;
        background: rgba(20, 20, 20, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        padding: 6px 0;
        min-width: 110px;
        display: none;
        z-index: 1000;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .quality-menu.show {
        display: block;
        animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .quality-option {
        padding: 8px 16px;
        color: rgba(255, 255, 255, 0.9);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 13px;
        text-align: left;
        white-space: nowrap;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .quality-option:hover {
        background: rgba(229, 9, 20, 0.3);
        color: white;
        padding-left: 20px;
    }

    .quality-option.selected {
        color: white;
        background: rgba(229, 9, 20, 0.2);
        font-weight: 500;
    }

    .quality-option.selected::after {
        content: '‚úì';
        margin-left: 10px;
        color: var(--accent-primary);
        font-weight: bold;
    }

    .quality-option[data-quality="auto"] {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 4px;
        padding-bottom: 10px;
    }

    .quality-info {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .quality-info i {
        color: var(--accent-primary);
    }

    .current-quality-info {
        font-weight: bold;
        color: var(--accent-primary);
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ */
    .hls-buffering {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--accent-primary);
        animation: spin 1s ease-in-out infinite;
        display: none;
        z-index: 10;
    }

    .hls-buffering.show {
        display: block;
    }

    @keyframes spin {
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç—Ä–µ–π–ª–µ—Ä–æ–º –∏ —Ñ–∏–ª—å–º–æ–º
        const tabBtns = document.querySelectorAll('.video-tab-btn[data-type]');
        const videoContents = document.querySelectorAll('.video-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.dataset.type;
                tabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                videoContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${type}Video`).classList.add('active');

                if (type === 'trailer' && onlinePlayer) {
                    onlinePlayer.pause();
                }
                if (type === 'movie' && onlinePlayer) {
                    onlinePlayer.play().catch(e => console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'));
                }
                updateUrlParams(type);
            });
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-–≤–∏–¥–µ–æ
        const onlinePlayer = document.getElementById('onlineMoviePlayer');

        if (onlinePlayer) {
            const videoWrapper = onlinePlayer.parentElement;
            const customControls = document.querySelector('.custom-video-controls');
            const playPauseBtn = document.querySelector('.play-pause-btn');
            const progressBar = document.querySelector('.progress-bar');
            const currentTimeEl = document.querySelector('.current-time');
            const totalTimeEl = document.querySelector('.total-time');
            const volumeBtn = document.querySelector('.volume-btn');
            const volumeSlider = document.querySelector('.volume-slider');
            const fullscreenBtn = document.querySelector('.fullscreen-btn');

            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
            const qualityBtn = document.querySelector('.quality-btn');
            const qualityMenu = document.querySelector('.quality-menu');
            const qualityOptions = document.querySelectorAll('.quality-option');
            const currentQualitySpan = document.querySelector('.current-quality');
            const currentQualityInfo = document.querySelector('.current-quality-info');

            // HLS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            let hls = null;
            let currentQuality = 'auto';
            let availableQualities = [];
            let bufferingIndicator = null;
            let controlsTimeout;
            let progressUpdateInterval;

            // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
            bufferingIndicator = document.createElement('div');
            bufferingIndicator.className = 'hls-buffering';
            videoWrapper.appendChild(bufferingIndicator);

            // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏
            function showControls() {
                if (customControls) {
                    customControls.style.opacity = '1';
                    customControls.style.visibility = 'visible';
                }
                clearTimeout(controlsTimeout);
                if (!onlinePlayer.paused) {
                    controlsTimeout = setTimeout(() => {
                        if (customControls && !customControls.matches(':hover')) {
                            customControls.style.opacity = '0';
                            customControls.style.visibility = 'hidden';
                        }
                    }, 3000);
                }
            }

            function hideControls() {
                if (customControls && !customControls.matches(':hover') && !onlinePlayer.paused) {
                    customControls.style.opacity = '0';
                    customControls.style.visibility = 'hidden';
                }
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            function formatTime(seconds) {
                if (isNaN(seconds) || seconds < 0) return '0:00';

                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);

                if (hrs > 0) {
                    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                } else {
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            function updateProgress() {
                if (!onlinePlayer || !onlinePlayer.duration) return;
                const currentTime = onlinePlayer.currentTime;
                const duration = onlinePlayer.duration;
                const percent = (currentTime / duration) * 100;

                if (progressBar) {
                    progressBar.value = percent;
                    progressBar.style.setProperty('--progress', percent + '%');
                }
                if (currentTimeEl) {
                    currentTimeEl.textContent = formatTime(currentTime);
                }
            }

            function updateTime() {
                if (totalTimeEl && onlinePlayer.duration) {
                    totalTimeEl.textContent = formatTime(onlinePlayer.duration);
                }
            }

            function updateQualityInfo(qualityName) {
                let displayName = 'Auto';

                console.log('updateQualityInfo called with:', qualityName);

                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º qualityName = 0 (—ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å)
                if (qualityName === 0 || qualityName === '0') {
                    console.log('Ignoring quality 0, keeping last displayed:', lastDisplayedQuality);
                    return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
                }

                if (!qualityName) {
                    displayName = 'Auto';
                }
                else if (!isNaN(qualityName) && qualityName !== 'Auto' && qualityName !== 'auto') {
                    displayName = qualityName + 'p';
                }
                else if (typeof qualityName === 'string' && qualityName.includes('p')) {
                    displayName = qualityName;
                }
                else if (qualityName === 'Auto' || qualityName === 'auto') {
                    displayName = 'Auto';
                }
                else if (qualityName) {
                    displayName = qualityName.toString();
                }

                console.log('Setting display name to:', displayName);

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
                lastDisplayedQuality = displayName;

                if (currentQualitySpan) {
                    currentQualitySpan.textContent = displayName;
                }
                if (currentQualityInfo) {
                    currentQualityInfo.textContent = displayName;
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —Ñ–∏–ª—å–º–∞
            function getMovieId() {
                return onlinePlayer.dataset.movieId;
            }

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—á–µ—Å—Ç–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
            async function fetchQualities() {
                const movieId = getMovieId();
                if (!movieId) {
                    console.log('Movie ID not found, using defaults');
                    return {
                        baseUrl: onlinePlayer.dataset.baseUrl,
                        qualities: ['1080p', '720p', '480p', '360p']
                    };
                }

                try {
                    const response = await fetch(`/api/movie/${movieId}/qualities`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch qualities');
                    }
                    const data = await response.json();
                    console.log(`Loaded qualities for movie ${movieId}:`, data);
                    return data;
                } catch (error) {
                    console.error('Error fetching qualities:', error);
                    return {
                        baseUrl: onlinePlayer.dataset.baseUrl,
                        qualities: ['1080p', '720p', '480p', '360p']
                    };
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–∞—á–µ—Å—Ç–≤
            function updateQualityMenuFromList(qualitiesList) {
                qualityOptions.forEach(option => {
                    const quality = option.dataset.quality;
                    if (quality === 'auto') return;

                    if (qualitiesList.includes(quality)) {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HLS
            async function initHLS(quality = 'auto') {
                if (hls) {
                    hls.destroy();
                }

                const qualityInfo = await fetchQualities();
                let baseUrl = qualityInfo.baseUrl;

                if (!baseUrl) {
                    console.error('No base URL for video');
                    return;
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
                if (!baseUrl.endsWith('/')) {
                    baseUrl = baseUrl + '/';
                }

                // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–π —Å–ª–µ—à –µ—Å–ª–∏ –µ—Å—Ç—å
                baseUrl = baseUrl.replace(/\/+$/, '');

                let manifestUrl;
                if (quality === 'auto') {
                    manifestUrl = baseUrl + '/master.m3u8';
                } else {
                    let qualityWithP = quality;
                    if (!isNaN(quality) && quality !== 'auto') {
                        qualityWithP = quality + 'p';
                    }

                    if (!qualityInfo.qualities.includes(qualityWithP)) {
                        console.log(`Quality ${qualityWithP} not available for movie ${getMovieId()}, using auto`);
                        manifestUrl = baseUrl + '/master.m3u8';
                    } else {
                        manifestUrl = baseUrl + '/' + qualityWithP + '/playlist.m3u8';
                    }
                }

                console.log(`Loading HLS for movie ${getMovieId()} from:`, manifestUrl);

                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–Ω—é
                updateQualityMenuFromList(qualityInfo.qualities);

                if (Hls.isSupported()) {
                    hls = new Hls({
                        maxBufferLength: 30,
                        maxMaxBufferLength: 600,
                        enableWorker: true,
                        lowLatencyMode: false,
                        backBufferLength: 90,
                        startLevel: quality === 'auto' ? -1 : -1
                    });

                    hls.loadSource(manifestUrl);
                    if (quality !== 'auto') {
                        // –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞–Ω–æ –∫–∞–∫ —á–∏—Å–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ —Å 'p'
                        updateQualityInfo(quality);
                    }
                    hls.attachMedia(onlinePlayer);

                    hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
                        console.log('HLS manifest parsed:', data);
                        availableQualities = data.levels.map(level => ({
                            height: level.height,
                            bitrate: level.bitrate,
                            name: level.height + 'p'
                        }));

                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ
                        if (quality === 'auto' && lastDisplayedQuality === 'Auto') {
                            updateQualityInfo('Auto');
                        } else if (quality !== 'auto') {
                            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
                            updateQualityInfo(quality);
                        }
                    });

                    hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                        if (hls.levels && hls.levels[data.level]) {
                            const level = hls.levels[data.level];
                            const qualityName = level.height.toString();
                            console.log('LEVEL_SWITCHED event, level index:', data.level, 'quality:', qualityName);

                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ —è–≤–Ω–æ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
                            if (qualityName !== '0') {
                                updateQualityInfo(qualityName);
                            } else {
                                console.log('Ignoring quality 0 from level switch');
                            }
                        } else {
                            console.log('LEVEL_SWITCHED event with no level data:', data);
                        }
                    });

                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error('HLS Error:', data);
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    hls.startLoad();
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    hls.recoverMediaError();
                                    break;
                                default:
                                    initHLS('auto');
                                    break;
                            }
                        }
                    });

                    hls.on(Hls.Events.BUFFER_STALLED, function() {
                        bufferingIndicator.classList.add('show');
                    });

                    hls.on(Hls.Events.BUFFER_APPENDED, function() {
                        bufferingIndicator.classList.remove('show');
                    });

                } else if (onlinePlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    onlinePlayer.src = manifestUrl;
                    availableQualities = qualityInfo.qualities.map(q => ({
                        height: parseInt(q),
                        name: q
                    }));
                    updateQualityMenuFromList(qualityInfo.qualities);
                }
            }

            // –°–º–µ–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–∞
            function switchQuality(quality) {
                console.log('switchQuality called with:', quality);

                const currentTime = onlinePlayer.currentTime;
                const wasPlaying = !onlinePlayer.paused;

                // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ –∏–∑ —Å—Ç—Ä–æ–∫–∏ (—É–±–∏—Ä–∞–µ–º 'p' –µ—Å–ª–∏ –µ—Å—Ç—å)
                let qualityValue = quality;
                if (quality !== 'auto' && quality.endsWith('p')) {
                    qualityValue = quality.slice(0, -1);
                }

                console.log('Quality value for HLS:', qualityValue);

                currentQuality = qualityValue;

                qualityOptions.forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.dataset.quality === quality) {
                        opt.classList.add('selected');
                    }
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const displayQuality = quality === 'auto' ? 'Auto' : quality;
                lastDisplayedQuality = displayQuality;

                // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateQualityInfo(displayQuality);

                initHLS(qualityValue).then(() => {
                    const restorePosition = function() {
                        onlinePlayer.currentTime = currentTime;
                        if (wasPlaying) {
                            onlinePlayer.play().catch(e => console.log('Play failed:', e));
                        }
                        onlinePlayer.removeEventListener('loadedmetadata', restorePosition);
                    };
                    onlinePlayer.addEventListener('loadedmetadata', restorePosition);
                });

                if (qualityMenu) {
                    qualityMenu.classList.remove('show');
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
            function initControls() {
                if (customControls) {
                    customControls.style.opacity = '0';
                    customControls.style.visibility = 'hidden';
                }

                videoWrapper.addEventListener('mousemove', showControls);
                videoWrapper.addEventListener('mouseenter', showControls);

                videoWrapper.addEventListener('mouseleave', () => {
                    if (!onlinePlayer.paused) hideControls();
                });

                onlinePlayer.addEventListener('pause', () => {
                    showControls();
                    videoWrapper.classList.add('video-paused');
                });

                onlinePlayer.addEventListener('play', () => {
                    videoWrapper.classList.remove('video-paused');
                    controlsTimeout = setTimeout(hideControls, 3000);
                });

                onlinePlayer.addEventListener('click', function() {
                    if (this.paused) {
                        this.play();
                    } else {
                        this.pause();
                    }
                    showControls();
                });

                if (customControls) {
                    customControls.addEventListener('mouseenter', showControls);
                    customControls.addEventListener('mouseleave', () => {
                        if (!onlinePlayer.paused) {
                            controlsTimeout = setTimeout(hideControls, 1000);
                        }
                    });
                }

                setTimeout(showControls, 500);
                setTimeout(() => {
                    if (!onlinePlayer.paused) hideControls();
                }, 2000);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–∞—á–µ—Å—Ç–≤–∞
            if (qualityBtn && qualityMenu) {
                qualityBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    qualityMenu.classList.toggle('show');
                });

                document.addEventListener('click', (e) => {
                    if (!qualityBtn.contains(e.target) && !qualityMenu.contains(e.target)) {
                        qualityMenu.classList.remove('show');
                    }
                });

                qualityOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        switchQuality(option.dataset.quality);
                    });
                });
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            initHLS('auto');
            setTimeout(() => {
                if (currentQualitySpan && currentQualitySpan.textContent === 'Auto') {
                    // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë Auto, –æ—Å—Ç–∞–≤–ª—è–µ–º
                } else {
                    updateQualityInfo('Auto');
                }
            }, 1000);
            initControls();

            // –ö–Ω–æ–ø–∫–∞ play/pause
            if (playPauseBtn) {
                playPauseBtn.addEventListener('click', function() {
                    if (onlinePlayer.paused) {
                        onlinePlayer.play();
                        this.innerHTML = '<i class="fas fa-pause"></i>';
                    } else {
                        onlinePlayer.pause();
                        this.innerHTML = '<i class="fas fa-play"></i>';
                    }
                });

                onlinePlayer.addEventListener('play', () => {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                });

                onlinePlayer.addEventListener('pause', () => {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
            }

            // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            if (progressBar) {
                progressBar.addEventListener('input', function() {
                    const time = (this.value / 100) * onlinePlayer.duration;
                    onlinePlayer.currentTime = time;
                });
                progressUpdateInterval = setInterval(updateProgress, 100);
            }

            // –ì—Ä–æ–º–∫–æ—Å—Ç—å
            if (volumeBtn && volumeSlider) {
                volumeBtn.addEventListener('click', function() {
                    if (onlinePlayer.volume > 0) {
                        onlinePlayer.volume = 0;
                        volumeSlider.value = 0;
                        this.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    } else {
                        onlinePlayer.volume = 1;
                        volumeSlider.value = 1;
                        this.innerHTML = '<i class="fas fa-volume-up"></i>';
                    }
                });

                volumeSlider.addEventListener('input', function() {
                    onlinePlayer.volume = this.value;
                    if (volumeBtn) {
                        if (this.value == 0) {
                            volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                        } else if (this.value < 0.5) {
                            volumeBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
                        } else {
                            volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                        }
                    }
                });
            }

            // –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        videoWrapper.requestFullscreen().catch(err => {
                            console.log('–û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞:', err);
                        });
                        this.innerHTML = '<i class="fas fa-compress"></i>';
                    } else {
                        document.exitFullscreen();
                        this.innerHTML = '<i class="fas fa-expand"></i>';
                    }
                });
            }

            // –°–æ–±—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);

            function handleFullscreenChange() {
                if (document.fullscreenElement ||
                        document.webkitFullscreenElement ||
                        document.mozFullScreenElement ||
                        document.msFullscreenElement) {
                    showControls();
                } else {
                    if (!onlinePlayer.paused) {
                        setTimeout(hideControls, 1000);
                    }
                }
            }

            // –°–æ–±—ã—Ç–∏—è –≤–∏–¥–µ–æ
            onlinePlayer.addEventListener('loadedmetadata', () => {
                updateTime();
                updateProgress();
            });

            onlinePlayer.addEventListener('timeupdate', updateProgress);

            onlinePlayer.addEventListener('ended', () => {
                if (playPauseBtn) {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
                if (progressBar) {
                    progressBar.value = 0;
                    progressBar.style.setProperty('--progress', '0%');
                }
                showControls();
            });

            onlinePlayer.addEventListener('waiting', () => {
                bufferingIndicator.classList.add('show');
            });

            onlinePlayer.addEventListener('playing', () => {
                bufferingIndicator.classList.remove('show');
            });

            onlinePlayer.addEventListener('error', () => {
                console.error('Video error occurred');
                bufferingIndicator.classList.remove('show');
            });

            videoWrapper.addEventListener('touchstart', function() {
                if (customControls) {
                    if (customControls.style.opacity === '1') {
                        hideControls();
                    } else {
                        showControls();
                    }
                }
            });

            window.addEventListener('beforeunload', () => {
                clearInterval(progressUpdateInterval);
                if (hls) {
                    hls.destroy();
                }
            });
        }

        function updateUrlParams(viewType) {
            const url = new URL(window.location);
            if (viewType === 'movie') {
                url.searchParams.set('view', 'movie');
            } else {
                url.searchParams.delete('view');
            }
            window.history.replaceState({}, '', url);
        }

        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const viewType = urlParams.get('view');
            if (viewType === 'movie') {
                const movieBtn = document.querySelector('[data-type="movie"]');
                if (movieBtn) movieBtn.click();
            }
        }
        checkUrlParams();
    });

    function switchToMovie() {
        const movieBtn = document.querySelector('[data-type="movie"]');
        if (movieBtn) {
            movieBtn.click();
            document.querySelector('.movie-video-block').scrollIntoView({
                behavior: 'smooth'
            });
        }
    }
</script>