<div class="page-container profile-page">

    <h1 class="page-title">{{title}}</h1>

    {{>profileNav}}

    <div class="profile-content-area">

        {{#if error}}
            <div class="alert alert-error">{{error}}</div>
        {{/if}}
        {{#if success}}
            <div class="alert alert-success">{{success}}</div>
        {{/if}}

        <h2>Ваши активные билеты</h2>

        {{#if tickets.length}}
            <div class="tickets-list">
                {{#each tickets}}
                    <div class="ticket-card">
                        <div class="ticket-details">
                            <h3>{{movie_title}}</h3>
                            <p><strong>Сеанс:</strong> {{formatDate starttime "DD.MM.YYYY в HH:mm"}}</p>
                            <p><strong>Зал:</strong> {{hall_name}}</p>
                            <p><strong>Место:</strong> Ряд {{rownum}}, Место {{seatnum}}</p>
                            <p><strong>Цена:</strong> {{totalprice}} BYN</p>
                            <span class="status-badge status-{{status}}">{{status}}</span>
                        </div>

                        {{!-- Если флаг isCancellableStatus установлен (проверка: статус 'Оплачен' и время сеанса > 2ч), показываем активную кнопку отмены --}}
                        {{#if isCancellableStatus}}
                        {{!-- Обновленный блок действий: кнопки расположены вертикально --}}
                            <div class="ticket-actions vertical-actions">
                                {{!-- 1. Кнопка изменена с "QR-код" на "Посмотреть детали" --}}
                                <a href="/profile/ticket/{{ticketid}}" class="btn btn-primary view-btn">
                                    Посмотреть детали
                                </a>
                                <form action="/profile/ticket/{{ticketid}}/cancel" method="POST">
                                    {{!-- <input type="hidden" name="_csrf" value="{{csrfToken}}"> --}}
                                    <button type="submit" class="btn btn-secondary cancel-btn" onclick="return confirm('Вы уверены, что хотите отменить этот билет? Возврат может занять некоторое время.')">
                                        Отменить билет
                                    </button>
                                </form>
                            </div>
                        {{else}}
                            <div class="ticket-actions vertical-actions">
                                <a href="/profile/ticket/{{ticketid}}" class="btn btn-secondary view-btn">
                                    Посмотреть детали
                                </a>
                                <button class="btn btn-secondary disabled-btn" disabled>
                                    {{#ifeq status 'Возвращен'}}Возвращен{{else}}Отмена недоступна{{/ifeq}}
                                </button>
                            </div>
                        {{/if}}
                    </div>
                {{/each}}
            </div>
        {{else}}
            <p class="no-tickets">У вас пока нет активных билетов. Время выбрать фильм!</p>
            <a href="/" class="btn btn-primary">Посмотреть Афишу</a>
        {{/if}}
    </div>
</div>