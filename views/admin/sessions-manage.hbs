<div class="page-container main-wrapper">
    <h1>üóìÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∞–Ω—Å–∞–º–∏</h1>

    {{#if error}}
        <div class="alert alert-error">{{error}}</div>
    {{/if}}
    {{#if success}}
        <div class="alert alert-success">{{success}}</div>
    {{/if}}

    <section class="admin-form-block">
        <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ–∞–Ω—Å</h2>
        <form action="/admin/sessions" method="POST" class="form-container">

            <div class="form-group">
                <label for="movieId">–§–∏–ª—å–º:</label>
                <select id="movieId" name="movieId" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º --</option>
                    {{#each movies}}
                        <option value="{{movieid}}"
                                {{#ifeq movieid ../formData.movieId}}selected{{/ifeq}}
                        >
                            {{title}} ({{price}} ‚ÇΩ)
                        </option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label for="hallId">–ó–∞–ª:</label>
                <select id="hallId" name="hallId" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª --</option>
                    {{#each halls}}
                        <option value="{{hallid}}"
                                {{#ifeq hallid ../formData.hallId}}selected{{/ifeq}}
                        >
                            {{name}} ({{rowscount}} —Ä—è–¥–æ–≤, {{seatsperrow}} –º–µ—Å—Ç)
                        </option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label for="startTime">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                <input type="datetime-local"
                       id="startTime"
                       name="startTime"
                       value="{{formData.startTime}}"
                       min="{{formatDate (now) 'YYYY-MM-DDTHH:MM'}}"
                       required>
                <small class="form-text-muted">–í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DDTHH:MM</small>
            </div>

            <button type="submit" class="btn btn-primary btn-lg">–°–æ–∑–¥–∞—Ç—å —Å–µ–∞–Ω—Å</button>
        </form>
    </section>

    <hr class="divider">

    <section class="screenings-list-block">
        <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ–∞–Ω—Å–æ–≤</h2>
        <div class="actions">
            <a href="/admin/sessions/report" class="btn btn-secondary">
                üìä –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç (CSV)
            </a>
        </div>
        {{#if upcomingScreenings.length}}
            <table class="admin-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>–§–∏–ª—å–º</th>
                    <th>–ó–∞–ª</th>
                    <th>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody>
                {{#each upcomingScreenings}}
                    <tr class="{{#if iscancelled}}cancelled-row{{/if}}">
                        <td>{{screeningid}}</td>
                        <td>{{movietitle}}</td>
                        <td>{{hallname}}</td>
                        <td>{{formatDate starttime 'D MMM YYYY –≤ HH:mm'}}</td>
                        <td>
                            {{#if iscancelled}}
                                <span class="status-cancelled">–û—Ç–º–µ–Ω–µ–Ω</span>
                            {{else}}
                                <span class="status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            {{/if}}
                        </td>
                        <td>
                            {{#unless iscancelled}}
                                <form action="/admin/sessions/{{screeningid}}/cancel" method="POST" style="display:inline;" onsubmit="return confirm('–û—Ç–º–µ–Ω–∏—Ç—å —Å–µ–∞–Ω—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–∏—Ç –≤—Å–µ –±—Ä–æ–Ω–∏.');">
                                    <button type="submit" class="btn-text-link btn-danger-link">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                                </form>
                            {{/unless}}
                        </td>
                    </tr>
                {{/each}}
                </tbody>
            </table>
        {{else}}
            <p>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ–∞–Ω—Å–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        {{/if}}
    </section>

</div>
<style>
    .main-wrapper {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        padding-bottom: 50px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .page-title {
        color: var(--accent-primary);
        text-align: center;
        margin-bottom: 40px;
        font-size: 36px;
        padding-top: 40px;
        font-weight: bold;
    }

    /* –ë–ª–æ–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ–∞–Ω—Å–∞ */
    .admin-form-block {
        background-color: var(--bg-card);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 20px var(--shadow-color);
        margin-bottom: 40px;
        transition: all 0.3s ease;
    }

    .admin-form-block h2 {
        color: var(--text-primary);
        margin-top: 0;
        margin-bottom: 25px;
        font-size: 24px;
        border-bottom: 2px solid var(--accent-primary);
        padding-bottom: 10px;
    }

    .form-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: var(--text-primary);
        font-size: 16px;
    }

    .form-group select,
    .form-group input[type="datetime-local"] {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--bg-input);
        color: var(--text-primary);
        font-size: 16px;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-group select:focus,
    .form-group input[type="datetime-local"]:focus {
        border-color: var(--accent-primary);
        outline: none;
        box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.1);
    }

    .form-text-muted {
        display: block;
        margin-top: 6px;
        font-size: 13px;
        color: var(--text-muted);
    }

    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
    .section-divider {
        border: 0;
        height: 1px;
        background-color: var(--border-color);
        margin: 40px 0;
        opacity: 0.5;
    }

    /* –°–µ–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Å–µ–∞–Ω—Å–æ–≤ */
    .screenings-list-block {
        margin-top: 30px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .section-header h2 {
        color: var(--text-primary);
        margin: 0;
        font-size: 24px;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        min-width: 120px;
    }

    .btn-primary {
        background-color: var(--accent-primary);
        color: white;
        padding: 12px 25px;
        font-size: 16px;
        margin-top: 10px;
        align-self: flex-start;
    }

    .btn-primary:hover {
        background-color: var(--accent-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(229, 9, 20, 0.3);
    }

    .btn-secondary {
        background-color: var(--border-color);
        color: var(--text-primary);
        padding: 10px 20px;
        font-size: 14px;
        border: 1px solid var(--border-light);
    }

    .btn-secondary:hover {
        background-color: var(--border-light);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow-color);
        color: var(--text-primary);
    }

    .btn:active {
        transform: translateY(0);
    }

    /* –¢–∞–±–ª–∏—Ü–∞ */
    .table-container {
        overflow-x: auto;
        margin-top: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-card);
    }

    .admin-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
    }

    .admin-table th {
        background-color: var(--accent-primary);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: bold;
        font-size: 15px;
        border-bottom: 2px solid var(--accent-hover);
    }

    .admin-table td {
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
        vertical-align: middle;
    }

    .admin-table tr:last-child td {
        border-bottom: none;
    }

    .admin-table tr:hover:not(.cancelled-row) {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .light-theme .admin-table tr:hover:not(.cancelled-row) {
        background-color: rgba(0, 0, 0, 0.02);
    }

    /* –°—Ç—Ä–æ–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–Ω–æ–≥–æ —Å–µ–∞–Ω—Å–∞ */
    .cancelled-row {
        background-color: var(--bg-primary);
        opacity: 0.7;
    }

    .cancelled-row td {
        color: var(--text-muted);
        text-decoration: line-through;
    }

    /* –ë–µ–π–¥–∂–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ */
    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-active {
        background-color: rgba(40, 167, 69, 0.2);
        color: var(--success-color);
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .status-cancelled {
        background-color: rgba(220, 53, 69, 0.2);
        color: var(--error-color);
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .action-cell {
        white-space: nowrap;
    }

    .btn-text-link {
        background: none;
        border: none;
        color: var(--accent-primary);
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .btn-danger-link {
        color: var(--error-color);
    }

    .btn-danger-link:hover {
        background-color: rgba(220, 53, 69, 0.1);
        text-decoration: underline;
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .alert {
        padding: 15px 20px;
        margin-bottom: 25px;
        border-radius: 6px;
        font-weight: bold;
        border: 1px solid transparent;
        transition: all 0.3s ease;
    }

    .alert-error {
        background-color: rgba(229, 9, 20, 0.1);
        color: var(--error-color);
        border-color: rgba(229, 9, 20, 0.3);
    }

    .alert-success {
        background-color: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
        border-color: rgba(40, 167, 69, 0.3);
    }

    /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
        background-color: var(--bg-card);
        border-radius: 10px;
        border: 2px dashed var(--border-color);
        margin-top: 20px;
    }

    .empty-state p {
        font-size: 18px;
        margin: 0;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è select */
    .form-group select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23f0f0f0' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 12px;
        padding-right: 40px;
    }

    .light-theme .form-group select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23212529' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .page-container {
            padding: 0 15px;
        }

        .page-title {
            font-size: 28px;
            padding-top: 30px;
            margin-bottom: 30px;
        }

        .admin-form-block {
            padding: 20px;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .btn-primary {
            align-self: stretch;
            text-align: center;
        }

        .btn-secondary {
            align-self: flex-start;
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 24px;
        }

        .admin-form-block h2,
        .section-header h2 {
            font-size: 20px;
        }

        .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .admin-table th,
        .admin-table td {
            padding: 10px;
            font-size: 14px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const startTimeInput = document.getElementById('startTime');

        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ (—Ç.–µ. –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ formData)
        if (!startTimeInput.value) {
            const now = new Date();
            // –°–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 15 –º–∏–Ω—É—Ç
            now.setMinutes(now.getMinutes() - (now.getMinutes() % 15) + 15);

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');

            const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
            startTimeInput.value = formattedDateTime;
        }
    });
</script>