<header class="header">

    <a href="/" class="logo">Cinema<span class="box-highlight">–í–æ—Ö</span></a>
    <nav class="nav">
        <a href="/" class="{{#if isHome}}active{{/if}}">–ê—Ñ–∏—à–∞</a>
        <a href="/movies?category=soon" class="{{#if isSoon}}active{{/if}}">–°–∫–æ—Ä–æ</a>
        <a href="/shorts" class="{{#if isShorts}}active{{/if}}">–®–æ—Ä—Ç—Å</a>

        <div class="filter-dropdown nav-filter">
            <button class="filter-dropdown-btn" title="–ü–æ–∏—Å–∫ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É">
                –§–∏–ª—å—Ç—Ä
            </button>

            <div class="filter-dropdown-content" id="filter-content">
                <form id="filter-form" action="/" method="GET">

                    <h3>–ü–æ–∏—Å–∫ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h3>

                    <label for="filter-year">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</label>
                    <input type="number" id="filter-year" name="year" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 2023" min="1900" max="{{currentYear}}" value="{{filterYear}}">

                    <label for="filter-genre">–ñ–∞–Ω—Ä:</label>
                    <select id="filter-genre" name="genre">
                        <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                        {{#each allGenres}}
                            <option value="{{this}}" {{#ifeq this filterGenre}}selected{{/ifeq}}>{{this}}</option>
                        {{/each}}
                    </select>

                    <label for="filter-rating">–†–µ–π—Ç–∏–Ω–≥ (–æ—Ç):</label>
                    <input type="number" id="filter-rating" name="minRating" placeholder="–û—Ç 4.0 –¥–æ 5.0" min="0" max="5" step="0.1" value="{{filterMinRating}}">

                    <div class="filter-actions">
                        <button type="submit" class="apply-filter-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        {{#if isFilterApplied}}
                            <button type="button" id="clear-filter-btn" class="clear-filter-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        {{/if}}
                    </div>
                </form>
            </div>
        </div>
    </nav>

    <div class="header-search-container">
        <form action="/" method="GET" class="search-form-header">
            <input type="text"
                   placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..."
                   name="searchTitle"
                   value="{{searchTitle}}"
                   aria-label="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">

            <button type="submit" class="search-button-header" title="–ù–∞–π—Ç–∏">
                üîç
            </button>
            {{#if searchTitle}}
                <a href="/" class="clear-search-button-header" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫">
                    √ó
                </a>
            {{/if}}
        </form>
    </div>

    <div class="user-controls">
        {{#if isAdmin}}
            <div class="admin-dropdown">
                <button class="admin-dropdown-btn">
                    <i class="material-icons">admin_panel_settings</i>
                    –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                    <i class="material-icons dropdown-arrow">arrow_drop_down</i>
                </button>
                <div class="admin-dropdown-content">
                    <a href="/admin/add" class="admin-link">‚ûï –§–∏–ª—å–º</a>
                    <a href="/admin/add-short" class="admin-link">‚ûï –®–æ—Ä—Ç—Å</a>
                    <a href="/admin/users" class="admin-link">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                    <a href="/admin/sessions" class="admin-link">üóìÔ∏è –°–µ–∞–Ω—Å—ã</a>
                </div>
            </div>
        {{/if}}
        <div class="theme-switcher">
            <button id="theme-toggle" class="theme-toggle-btn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <i class="material-icons theme-icon" id="theme-icon">dark_mode</i>
            </button>
        </div>

        {{#if isAuth}}
            <a href="/profile" class="profile-link">
                <i class="material-icons">person</i>
                –ü—Ä–æ—Ñ–∏–ª—å
            </a>
            <form action="/auth/logout" method="POST" style="display: inline;">
                <button type="submit" class="auth-btn" style="border: none; background: none; cursor: pointer; color: inherit; font-size: 16px; padding: 0;">
                    –í—ã–π—Ç–∏
                </button>
            </form>
        {{else}}
            <a href="/auth/login" class="auth-btn">–í–æ–π—Ç–∏</a>
        {{/if}}
    </div>
</header>
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
    .admin-dropdown {
        position: relative;
        display: inline-block;
    }

    .admin-dropdown-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        background-color: var(--bg-input);
        color: #f0f0f0;
        border: 1px solid var(--border-light);
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .admin-dropdown-btn:hover {
        background-color: var(--bg-input-focus);
        border-color: var(--accent-primary);
    }

    .admin-dropdown-btn i:first-child {
        color: var(--accent-primary);
    }

    .dropdown-arrow {
        font-size: 18px;
        transition: transform 0.3s ease;
        color: #f0f0f0;
    }

    .admin-dropdown:hover .dropdown-arrow {
        transform: rotate(180deg);
    }

    .admin-dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: var(--bg-card);
        min-width: 180px;
        border-radius: 8px;
        box-shadow: 0 8px 20px var(--shadow-color);
        border: 1px solid var(--border-color);
        z-index: 1000;
        margin-top: 5px;
        overflow: hidden;
    }


    .admin-dropdown:hover .admin-dropdown-content {
        display: block;
    }

    .admin-dropdown-content .admin-link {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        color: var(--text-primary);
        text-decoration: none;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.2s ease;
        font-size: 13px;
        white-space: nowrap;
    }

    .admin-dropdown-content .admin-link:last-child {
        border-bottom: none;
    }

    .admin-dropdown-content .admin-link:hover {
        background-color: var(--bg-input-focus);
        color: var(--accent-primary);
        padding-left: 20px;
    }

    .filter-dropdown.nav-filter {
        display: inline-block;
        position: relative;
        align-self: center;
    }

    .filter-dropdown-btn {
        display: flex;
        align-items: center;
        gap: 5px;
        background: transparent;
        color: var(--text-primary);
        border: none;
        padding: 8px 0;
        font-size: 16px;
        opacity: 0.7;
        transition: all 0.2s ease;
        height: 100%;
        cursor: pointer;
        font-weight: 500;
    }

    .filter-dropdown-btn:hover,
    .filter-dropdown.active .filter-dropdown-btn {
        opacity: 1;
        color: var(--accent-primary);
    }

    .filter-dropdown-content {
        position: absolute;
        left: 0;
        top: 100%;
        background-color: var(--bg-card);
        width: 280px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 10px 30px var(--shadow-color);
        border: 1px solid var(--border-color);
        z-index: 1001;
        margin-top: 10px;
        display: none;
        animation: fadeIn 0.2s ease;
    }


    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –≤–Ω—É—Ç—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞ */
    #filter-form label {
        display: block;
        color: var(--text-secondary);
        font-size: 13px;
        margin-top: 12px;
        margin-bottom: 6px;
        font-weight: 500;
    }

    #filter-form input[type="number"],
    #filter-form select {
        width: 100%;
        padding: 10px 12px;
        margin-bottom: 10px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-input);
        color: var(--text-primary);
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 14px;
        transition: border-color 0.3s ease;
    }

    .filter-actions {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        margin-top: 20px;
    }
    .apply-filter-btn,
    .clear-filter-btn {
        flex-grow: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .apply-filter-btn { background: #e50914; color: white; }
    .clear-filter-btn { background: #444; color: white; }

    .light-theme .nav a,
    .light-theme .auth-btn,
    .light-theme .profile-link,
    .light-theme .profile-link i,
    .light-theme .box-highlight,
    .light-theme .theme-toggle-btn,
    .light-theme .admin-dropdown-btn,
    .light-theme .dropdown-arrow,
    .light-theme .filter-dropdown-btn,
    .light-theme .apply-filter-btn,
    .light-theme .clear-filter-btn {
        color: #f0f0f0 !important;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- –õ–æ–≥–∏–∫–∞ –¥–ª—è Admin Dropdown (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const adminDropdown = document.querySelector('.admin-dropdown');
        let hideTimeout;

        if (adminDropdown) {
            const adminBtn = adminDropdown.querySelector('.admin-dropdown-btn');
            const dropdownContent = adminDropdown.querySelector('.admin-dropdown-content');

            adminBtn.addEventListener('mouseenter', function() {
                clearTimeout(hideTimeout);
                dropdownContent.style.display = 'block';
            });
            adminDropdown.addEventListener('mouseenter', function() {
                clearTimeout(hideTimeout);
                dropdownContent.style.display = 'block';
            });
            adminDropdown.addEventListener('mouseleave', function() {
                hideTimeout = setTimeout(function() {
                    dropdownContent.style.display = 'none';
                }, 300);
            });
            document.addEventListener('click', function(event) {
                if (!adminDropdown.contains(event.target)) {
                    dropdownContent.style.display = 'none';
                }
            });
        }

        // --- –õ–æ–≥–∏–∫–∞ –¥–ª—è Filter Dropdown (–û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–∞) ---
        const filterDropdown = document.querySelector('.filter-dropdown.nav-filter');
        const filterBtn = document.querySelector('.filter-dropdown-btn');
        const filterContent = document.getElementById('filter-content');
        const clearFilterBtn = document.getElementById('clear-filter-btn');

        if (filterDropdown) {

            // 1. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ –∫–ª–∏–∫—É
            filterBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const isHidden = filterContent.style.display === 'none' || filterContent.style.display === '';
                filterContent.style.display = isHidden ? 'block' : 'none';

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å active –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏
                filterDropdown.classList.toggle('active', isHidden);
            });

            // 2. –°–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
            document.addEventListener('click', (e) => {
                if (!filterDropdown.contains(e.target)) {
                    filterContent.style.display = 'none';
                    filterDropdown.classList.remove('active');
                }
            });

            // 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–∞
            if (clearFilterBtn) {
                clearFilterBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // –°–±—Ä–æ—Å –≤—Å–µ—Ö GET-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                    window.location.href = '/';
                });
            }
        }
    });
</script>