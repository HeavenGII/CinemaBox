<div class="page-container">
    <h1 class="page-title">{{title}}</h1>

    <div class="profile-content-area admin-form-area">
        {{#if warning}}
            <div class="alert alert-warning">{{warning}}</div>
        {{/if}}
        {{#if error}}
            <div class="alert alert-error">{{error}}</div>
        {{/if}}
        {{#if success}}
            <div class="alert alert-success">{{success}}</div>
        {{/if}}

        <form action="/admin/movies/{{movieData.movieid}}/edit"
              method="POST"
              class="add-movie-form"
              enctype="multipart/form-data">

            <h2>Редактирование фильма ID: {{movieData.movieid}}</h2>

            <div class="form-group">
                <label for="title">Название фильма</label>
                <input type="text" id="title" name="title" value="{{movieData.title}}" required>
            </div>

            <div class="form-group">
                <label for="originaltitle">Оригинальное название</label>
                <input type="text" id="originaltitle" name="originaltitle" value="{{movieData.originaltitle}}" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="durationmin">Продолжительность (мин)</label>
                    <input type="number" id="durationmin" name="durationmin" value="{{movieData.durationmin}}" required min="1">
                </div>

                <div class="form-group">
                    <label for="releaseYear">Год выпуска</label>
                    <input type="number" id="releaseYear" name="releaseYear" value="{{movieData.releaseyear}}" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="genre">Жанр</label>
                    <input type="text" id="genre" name="genre" value="{{movieData.genre}}" required
                           placeholder="Например: Фантастика, Триллер, Драма">
                </div>

                <div class="form-group">
                    <label for="price">Базовая цена билета (BYN)</label>
                    <input type="number" id="price" name="price" value="{{movieData.price}}" step="0.01" min="0" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="directorName">Режиссер (Полное имя)</label>
                    <input type="text" id="directorName" name="directorName" value="{{movieData.directorname}}" required>
                </div>

                <div class="form-group">
                    <label for="agerestriction">Возрастное ограничение</label>
                    <select id="agerestriction" name="agerestriction" required>
                        <option value="0" {{#ifeq movieData.agerestriction 0}}selected{{/ifeq}}>0+</option>
                        <option value="6" {{#ifeq movieData.agerestriction 6}}selected{{/ifeq}}>6+</option>
                        <option value="12" {{#ifeq movieData.agerestriction 12}}selected{{/ifeq}}>12+</option>
                        <option value="16" {{#ifeq movieData.agerestriction 16}}selected{{/ifeq}}>16+</option>
                        <option value="18" {{#ifeq movieData.agerestriction 18}}selected{{/ifeq}}>18+</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="posterFile">Постер (Оставьте пустым для сохранения текущего)</label>
                    <input type="file" id="posterFile" name="posterFile">

                    {{#if movieData.posterurl}}
                        <div class="current-poster-preview">
                            <p>Текущий постер:</p>
                            <img src="{{movieData.posterurl}}" alt="Текущий постер" class="current-poster-img">
                        </div>
                    {{/if}}
                </div>

                <div class="form-group">
                    <label for="trailerUrl">Ссылка на Трейлер</label>
                    <input type="url" id="trailerUrl" name="trailerUrl" value="{{movieData.trailerurl}}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="onlineEnabled" name="onlineEnabled" {{#if movieData.onlineenabled}}checked{{/if}}>
                    <label for="onlineEnabled">Доступен для онлайн-просмотра</label>
                </div>
            </div>

            <div id="onlineUrlSection" class="form-row" {{#unless movieData.onlineenabled}}style="display: none;"{{/unless}}>
                <div class="form-group">
                    <label for="onlineUrl">Ссылка на фильм в облачном хранилище</label>
                    <input type="url" id="onlineUrl" name="onlineUrl"
                           value="{{movieData.onlineurl}}"
                           placeholder="https://storage.yandexcloud.net/bucket/filename.mp4">
                    <small class="form-text">
                        {{#if movieData.onlineurl}}
                            <a href="{{movieData.onlineurl}}" target="_blank" class="current-link">
                                <i class="fas fa-external-link-alt"></i> Текущий файл
                            </a>
                        {{/if}}
                    </small>
                </div>
            </div>

            <!-- ДОБАВЛЕННЫЙ БЛОК: Доступные качества видео -->
            <div class="form-row">
                <div class="form-group">
                    <label>Доступные качества видео:</label>
                    <div class="qualities-checkbox-group">
                        <label class="checkbox-inline">
                            <input type="checkbox" name="qualities" value="1080p" {{#if (includes movieData.qualities "1080p")}}checked{{/if}}> 1080p
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" name="qualities" value="720p" {{#if (includes movieData.qualities "720p")}}checked{{/if}}> 720p
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" name="qualities" value="480p" {{#if (includes movieData.qualities "480p")}}checked{{/if}}> 480p
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" name="qualities" value="360p" {{#if (includes movieData.qualities "360p")}}checked{{/if}}> 360p
                        </label>
                    </div>
                    <small class="form-text">Выберите качества, доступные для этого фильма</small>
                </div>
            </div>

            <div class="form-group description-full-width">
                <label for="description">Описание / Сюжет</label>
                <textarea id="description" name="description" rows="5" required>{{movieData.description}}</textarea>
            </div>

            <div class="form-group checkbox-group">
                <input type="checkbox" id="isActive" name="isActive" {{#if movieData.isactive}}checked{{/if}}>
                <label for="isActive">Активен в прокате</label>
            </div>

            <button type="submit" class="btn btn-primary profile-submit-btn">Обновить фильм</button>
        </form>

        <div class="delete-movie-block">
            <form action="/admin/movies/{{movieData.movieid}}/delete" method="POST" onsubmit="return confirm('Вы уверены, что хотите удалить этот фильм? Это действие необратимо!');">
                <button type="submit" class="btn btn-danger delete-btn">
                    <i class="fas fa-trash"></i> Удалить фильм
                </button>
            </form>
        </div>
    </div>
</div>
